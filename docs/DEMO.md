# DEMO

Сценарий демонстрации на 3–5 минут. Цель — показать требования (ПК 2.1), интеграцию (ПК 2.2), отладку/логи (ПК 2.3), тесты (ПК 2.4), стандарты (ПК 2.5).

## 0) Подготовка

Открыть два терминала в корне репозитория.

## 1) Запуск web + api

Команды:

```bash
bun run dev:api
```

```bash
bun run dev:web
```

Ожидаемый результат:

- API доступен на http://localhost:3002
- Web доступен на http://localhost:3000

Закрывает: ПК 2.3 (реализация + запуск).

## 2) Swagger и контракт API

Открыть Swagger: http://localhost:3002/docs

Ожидаемый результат:

- Видны эндпоинты `/api/tickets`, `/api/sla`, `/api/auth` и DTO.
- Совпадает с `docs/API_CONTRACT.md`.

Закрывает: ПК 2.1 (требования/контракт), ПК 2.2 (структура данных).

## 3) Создание тикета (сквозной сценарий)

Действия:

- Открыть http://localhost:3000/tickets
- Создать тикет (заголовок + описание).

Ожидаемый результат:

- Тикет появляется в списке.
- В логах API видны Audit/Notifications и requestId.
- Web получает событие `ticket.created` (realtime).

Закрывает: ПК 2.2 (интеграция), ПК 2.3 (логи/отладка).

## 4) Назначение агента и смена статуса

Действия:

- В карточке тикета выбрать агента (если логин под ADMIN).
- Изменить статус на IN_PROGRESS.

Ожидаемый результат:

- В UI обновлены assignee и статус.
- В логах API фиксируются Audit/Notifications + requestId.
- Событие `ticket.updated` уходит в realtime.

Закрывает: ПК 2.2, ПК 2.3.

## 5) Комментарии

Действия:

- Открыть блок комментариев.
- Добавить комментарий.

Ожидаемый результат:

- Комментарий появляется в списке.
- `commentsCount` увеличивается.
- В логах есть Audit/Notifications + requestId.
- Событие `comment.added` в realtime.

Закрывает: ПК 2.2, ПК 2.3.

## 6) SLA и breach (ускоренная проверка)

Действия:

- Открыть SLA на тикете.
- (Если нужно) временно изменить `responseMinutes` в `apps/api/src/sla/sla.service.ts` на `0`.
- Перезапустить API и дождаться проверки (до 30 секунд).

Ожидаемый результат:

- В UI видно “SLA просрочен (breached)”.
- В логах Audit/Notifications фиксируется breach.

Закрывает: ПК 2.2, ПК 2.3.

## 7) Логи с requestId

Действия:

- Открыть `docs/DEBUGGING.md`.
- В логах API показать `requestId` и заголовок `X-Request-Id`.

Ожидаемый результат:

- У каждой операции есть requestId для трассировки.

Закрывает: ПК 2.3.

## 8) Тесты и линт

Команды:

```bash
bun run test
bun run lint
```

Или одним шагом:

```bash
bun run smoke
```

Ожидаемый результат:

- Все проверки проходят без ошибок.

Закрывает: ПК 2.4 (тестирование), ПК 2.5 (стандарты).
